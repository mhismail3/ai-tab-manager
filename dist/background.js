/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";var t,e,r={},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var a=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function i(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,s=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return s(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function l(){l=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:P(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",m="suspendedYield",v="executing",g="completed",y={};function b(){}function w(){}function x(){}var k={};f(k,c,(function(){return this}));var E=Object.getPrototypeOf,L=E&&E(E(N([])));L&&L!==r&&n.call(L,c)&&(k=L);var S=x.prototype=b.prototype=Object.create(k);function O(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,c,u){var s=p(t[o],t,i);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==a(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=d;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=T(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?g:m,s.arg===y)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function T(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(a(e)+" is not iterable")}return w.prototype=x,o(S,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},O(j.prototype),f(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new j(h(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(S),f(S,s,"Generator"),f(S,c,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function f(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function h(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){f(a,n,o,i,c,"next",t)}function c(t){f(a,n,o,i,c,"throw",t)}i(void 0)}))}}o.m=r,o.amdD=function(){throw new Error("define cannot be used indirect")},o.amdO={},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>(({121:"vendor",702:"vendor.tensorflow"}[t]||t)+".js"),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="ai-tab-manager:",o.l=(r,n,a,i)=>{if(t[r])t[r].push(n);else{var c,u;if(void 0!==a)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var f=s[l];if(f.getAttribute("src")==r||f.getAttribute("data-webpack")==e+a){c=f;break}}c||(u=!0,(c=document.createElement("script")).charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.setAttribute("data-webpack",e+a),c.src=r),t[r]=[n];var h=(e,n)=>{c.onerror=c.onload=null,clearTimeout(p);var o=t[r];if(delete t[r],c.parentNode&&c.parentNode.removeChild(c),o&&o.forEach((t=>t(n))),e)return e(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:c}),12e4);c.onerror=h.bind(null,c.onerror),c.onload=h.bind(null,c.onload),u&&document.head.appendChild(c)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),o.j=471,(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={471:0};o.f.j=(e,r)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)r.push(n[2]);else{var a=new Promise(((r,o)=>n=t[e]=[r,o]));r.push(n[2]=a);var i=o.p+o.u(e),c=new Error;o.l(i,(r=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var a=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;c.message="Loading chunk "+e+" failed.\n("+a+": "+i+")",c.name="ChunkLoadError",c.type=a,c.request=i,n[1](c)}}),"chunk-"+e,e)}};var e=(e,r)=>{var n,a,[i,c,u]=r,s=0;if(i.some((e=>0!==t[e]))){for(n in c)o.o(c,n)&&(o.m[n]=c[n]);u&&u(o)}for(e&&e(r);s<i.length;s++)a=i[s],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0},r=self.webpackChunkai_tab_manager=self.webpackChunkai_tab_manager||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),o.nc=void 0;var p={Shopping:["amazon","ebay","shop","product","buy","price","sale","cart","checkout","order","store","retail","purchase","shipping","discount","deal","marketplace","customer","ecommerce"],"Social Media":["facebook","twitter","instagram","tiktok","linkedin","social","profile","feed","timeline","post","friend","follow","share","comment","like","status","snapchat","pinterest","youtube","reddit"],News:["news","article","politics","report","cnn","bbc","nytimes","media","breaking","headlines","journalist","reporting","current events","newspaper","reuters","ap","associated press","editorial","opinion","analysis"],Tech:["github","stackoverflow","code","programming","developer","tech","software","engineer","api","documentation","repository","framework","library","development","algorithm","computer","technology","coding","data","cloud"],Education:["course","learn","study","education","university","college","academic","school","lecture","tutorial","professor","student","teach","class","degree","curriculum","exam","lesson","assignment","syllabus"],Entertainment:["youtube","video","movie","music","stream","netflix","hulu","entertainment","watch","play","game","gaming","film","tv","show","series","episode","actor","album","artist"],Productivity:["docs","sheet","presentation","calendar","meeting","email","task","project","workflow","productivity","organize","collaborate","document","spreadsheet","schedule","planning","notes","todo","reminder","agenda"],Finance:["bank","finance","money","investment","stock","crypto","budget","financial","trading","market","economy","currency","wallet","transaction","payment","loan","credit","debit","mortgage","portfolio"],Travel:["hotel","flight","booking","travel","vacation","destination","trip","tourism","airbnb","expedia","airline","resort","accommodation","ticket","reservation","itinerary","tourist","holiday","journey","adventure"],Health:["health","fitness","workout","nutrition","diet","medical","exercise","wellness","doctor","symptoms","hospital","medicine","patient","disease","healthcare","therapy","treatment","diagnosis","clinic","pharmacy"],Reference:["wikipedia","dictionary","encyclopedia","reference","wiki","research","definition","information","knowledge","guide","manual","handbook","resource","citation","source","lookup","archive","database","facts","history"],Communication:["gmail","outlook","email","chat","message","conversation","communication","slack","discord","teams","zoom","meet","conference","call","video","voice","contact","inbox","send","receive"]},d={"youtube.com":"Entertainment","github.com":"Tech","stackoverflow.com":"Tech","amazon.com":"Shopping","ebay.com":"Shopping","facebook.com":"Social Media","twitter.com":"Social Media","instagram.com":"Social Media","linkedin.com":"Social Media","reddit.com":"Social Media","gmail.com":"Communication","outlook.com":"Communication","yahoo.com":"Communication","google.com":"Search","bing.com":"Search","docs.google.com":"Productivity","drive.google.com":"Productivity","sheets.google.com":"Productivity","office.com":"Productivity","netflix.com":"Entertainment","hulu.com":"Entertainment","spotify.com":"Entertainment","wikipedia.org":"Reference","medium.com":"Reading","nytimes.com":"News","cnn.com":"News","bbc.com":"News","coursera.org":"Education","udemy.com":"Education","edx.org":"Education","khanacademy.org":"Education"},m=new Map,v={},g=0,y=864e5,b=[],w=new Map,x=function(){var t=Date.now();return(b=b.filter((function(e){return t-e<6e4}))).length<10},k=function(t){return t&&"string"==typeof t&&t.startsWith("hf_")&&t.length>8},E=function(){var t=h(l().mark((function t(){var e,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,chrome.storage.sync.get(["huggingfaceApiKey"]);case 3:return e=t.sent,r=e.huggingfaceApiKey,t.abrupt("return",k(r)?r:null);case 8:return t.prev=8,t.t0=t.catch(0),console.warn("Failed to get API key from storage:",t.t0),t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}(),L=function(){var t=h(l().mark((function t(e,r){var n,o,a,i,c,u,s,f;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E();case 2:if(n=t.sent){t.next=6;break}return console.log("No valid API key found, using keyword classification"),t.abrupt("return",null);case 6:if(o="".concat(e).concat(r),!((a=w.get(o))&&Date.now()-a.timestamp<y)){t.next=11;break}return console.log("Using cached AI classification result"),t.abrupt("return",a.categories);case 11:if(x()){t.next=14;break}return console.warn("AI classification rate limit reached, falling back to keyword classification"),t.abrupt("return",null);case 14:i="".concat(e," ").concat(r),c=Object.keys(p),u=0,s=l().mark((function t(){var e,r,a,s,f;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,b.push(Date.now()),console.log("Attempting AI classification..."),t.next=5,fetch("https://api-inference.huggingface.co/models/facebook/bart-large-mnli",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({inputs:i,parameters:{candidate_labels:c}})});case 5:if((e=t.sent).ok){t.next=11;break}return t.next=9,e.text();case 9:throw r=t.sent,new Error("HuggingFace API error: ".concat(r));case 11:return t.next=13,e.json();case 13:if(!((a=t.sent)&&a.labels&&a.scores)){t.next=21;break}return console.log("AI classification successful"),s=a.labels.filter((function(t,e){return a.scores[e]>.25})),f=s.length>0?s:[a.labels[0]],w.set(o,{categories:f,timestamp:Date.now()}),t.abrupt("return",{v:f});case 21:return t.abrupt("return",{v:null});case 24:if(t.prev=24,t.t0=t.catch(0),console.warn("AI classification attempt ".concat(u+1," failed:"),t.t0),!(u<2)){t.next=33;break}return t.next=30,new Promise((function(t){return setTimeout(t,1e3*(u+1))}));case 30:u++,t.next=35;break;case 33:return console.log("AI classification failed, falling back to keyword classification"),t.abrupt("return",{v:null});case 35:case"end":return t.stop()}}),t,null,[[0,24]])}));case 18:if(!(u<=2)){t.next=25;break}return t.delegateYield(s(),"t0",20);case 20:if(!(f=t.t0)){t.next=23;break}return t.abrupt("return",f.v);case 23:t.next=18;break;case 25:return t.abrupt("return",null);case 26:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}();setInterval((function(){var t,e=Date.now(),r=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=u(t))){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(i)throw o}}}}(w.entries());try{for(r.s();!(t=r.n()).done;){var n=c(t.value,2),o=n[0];e-n[1].timestamp>y&&w.delete(o)}}catch(t){r.e(t)}finally{r.f()}}),y);var S=function(){var t=h(l().mark((function t(e){var r,n,o,a,i,u,s,f;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!m.has(e.url)){t.next=2;break}return t.abrupt("return",m.get(e.url));case 2:return r=j(e.url),n=A(e.title,e.url),o=[],a="keyword",t.prev=6,t.next=9,L(e.title,e.url);case 9:(i=t.sent)&&i.length>0&&(o=i,a="ai"),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),console.warn("AI classification failed:",t.t0);case 16:return 0===o.length&&(console.log("Using keyword-based classification"),u=N(e.title,e.url,r,n),o=Object.entries(u).filter((function(t){var e=c(t,2);return e[0],e[1]>.25})).sort((function(t,e){return e[1]-t[1]})).map((function(t){return c(t,1)[0]}))),s=I(e.title,e.url),f={id:e.id,url:e.url,domain:r,title:e.title,keywords:n,categories:o,topics:s,timestamp:Date.now(),classificationMethod:a},m.set(e.url,f),t.abrupt("return",f);case 21:case"end":return t.stop()}}),t,null,[[6,13]])})));return function(e){return t.apply(this,arguments)}}(),O=function(){var t=h(l().mark((function t(e){var r,n,o,a,i,u,s,f,h;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return _(e),t.next=3,Promise.all(e.map((function(t){return S(t)})));case 3:return r=t.sent,n={},o=[],r.forEach((function(t){if(t.categories.length>0){var r=t.categories[0];n[r]||(n[r]=[]),n[r].push(e.find((function(e){return e.id===t.id})))}else o.push({tab:e.find((function(e){return e.id===t.id})),analysis:t})})),a={},o.forEach((function(t){var e=t.tab,r=t.analysis,o=T(r.domain);if(o)n[o]||(n[o]=[]),n[o].push(e);else{var i=P(r.domain);a[i]||(a[i]=[]),a[i].push(e)}})),i={},Object.entries(a).forEach((function(t){var e=c(t,2),n=e[0],o=e[1];if(o.length<=2){var u=o.map((function(t){var e=r.find((function(e){return e.id===t.id}));return{tab:t,analysis:e}})),s={};u.forEach((function(t){var e=t.analysis;e.topics.length>0&&e.topics.forEach((function(t){s[t]=(s[t]||0)+1}))}));var l=Object.entries(s).sort((function(t,e){return e[1]-t[1]}));if(l.length>0){var f=c(l[0],1)[0];i[f]||(i[f]=[]),o.forEach((function(t){i[f].push(t)})),delete a[n]}}})),u={},Object.entries(n).forEach((function(t){var e=c(t,2),n=e[0],o=e[1];if(o.length>=2)u[n]=o;else if(1===o.length){var s=o[0],l=r.find((function(t){return t.id===s.id})),f=!1;if(l&&l.topics.length>0){var h=l.topics[0];i[h]&&(i[h].push(s),f=!0)}if(!f){var p=P(l.domain);a[p]?a[p].push(s):a[p]=[s]}}})),Object.entries(a).forEach((function(t){var e=c(t,2),r=e[0],n=e[1];n.length>=2&&(u[r]=n)})),Object.entries(i).forEach((function(t){var e=c(t,2),r=e[0],n=e[1];if(n.length>=2){var o=r.charAt(0).toUpperCase()+r.slice(1);u[o]=n}})),(s=e.filter((function(t){return!Object.values(u).flat().some((function(e){return e.id===t.id}))}))).length>0&&(f=G(s,r),Object.entries(f).forEach((function(t){var e=c(t,2),r=e[0],n=e[1];u[r]=n})),(h=s.filter((function(t){return!Object.values(f).flat().some((function(e){return e.id===t.id}))}))).length>0&&(u.Other=h)),t.abrupt("return",u);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),j=function(t){try{return new URL(t).hostname.replace("www.","")}catch(t){return""}},P=function(t){if(!t)return"Unknown";var e=t.split("."),r=e.length>1?e[e.length-2]:e[0];return r.charAt(0).toUpperCase()+r.slice(1)},T=function(t){if(d[t])return d[t];for(var e=0,r=Object.entries(d);e<r.length;e++){var n=c(r[e],2),o=n[0],a=n[1];if(t.includes(o)||o.includes(t))return a}return null},_=function(t){0!==t.length&&(g>1e3&&(v={},g=0),t.forEach((function(t){var e="".concat(t.title," ").concat(j(t.url)).toLowerCase().split(/\s+/).filter((function(t){return t.length>2}));i(new Set(e)).forEach((function(t){v[t]=(v[t]||0)+1}))})),g+=t.length)},A=function(t,e){if(!t)return[];var r="".concat(t," ").concat(j(e)).toLowerCase().replace(/[-_.|]/g," ").replace(/[^\w\s]/g,"").split(/\s+/).filter((function(t){return t.length>2&&!["and","the","for","with","this","that","from","what","how","when","who","where"].includes(t)})),n={};r.forEach((function(t){n[t]=(n[t]||0)+1}));var o={};Object.entries(n).forEach((function(t){var e=c(t,2),n=e[0],a=e[1]/r.length,i=v[n]||1,u=Math.log((g+1)/(i+1))+1;o[n]=a*u}));var a=Object.entries(o).sort((function(t,e){return e[1]-t[1]})).map((function(t){return c(t,1)[0]})).slice(0,10),u=j(e).split(".").filter((function(t){return t.length>2&&!["www","com","org","net","edu","gov","io"].includes(t)}));return i(new Set([].concat(i(a),i(u))))},I=function(t,e){if(!t)return[];var r=t.toLowerCase(),n=j(e),o=[];return["guide","tutorial","review","news","article","blog","forum","discussion","video","photo","image","music","audio","podcast","stream","shop","store","product","cart","checkout","order","login","account","profile","settings","dashboard","search","results","find","query","download","upload","share","file","map","location","direction","travel","weather","forecast","temperature","job","career","employment","hire","recipe","food","cooking","meal","game","play","gaming","sport","health","medical","fitness","exercise"].forEach((function(t){r.includes(t)&&o.push(t)})),Object.entries(p).forEach((function(t){var e=c(t,2),a=e[0];e[1].forEach((function(t){if(r.includes(t)||n.includes(t)){var e=a.toLowerCase();o.includes(e)||o.push(e)}}))})),o},N=function(t,e,r,n){var o={},a=T(r);return a?(o[a]=1,o):(Object.entries(p).forEach((function(a){var i=c(a,2),u=i[0],s=i[1],l=0;s.forEach((function(n){var o=n.toLowerCase();r===o?l+=3:r.includes(o)?l+=2:e.toLowerCase().includes(o)&&(l+=1),t.toLowerCase().includes(o)&&(l+=1.5)})),n.forEach((function(t){s.forEach((function(e){t===e?l+=1:(t.includes(e)||e.includes(t))&&(l+=.5)}))}));var f=3+2*s.length+n.length*s.length;o[u]=l/(f||1)})),o)},G=function(t,e){if(0===t.length)return{};if(t.length<=3)return{Other:t};var r={},n=new Set,o=t.map((function(t){var r=e.find((function(e){return e.id===t.id}))||{id:t.id,keywords:[],topics:[],domain:j(t.url)};return{tab:t,analysis:r}})),a={};o.forEach((function(t){var e=t.tab,r=t.analysis;r.domain&&(a[r.domain]||(a[r.domain]=[]),a[r.domain].push(e))})),Object.entries(a).forEach((function(t){var e=c(t,2),o=e[0],a=e[1];if(a.length>=2){var i=P(o);r[i]=a,a.forEach((function(t){return n.add(t.id)}))}}));var i=o.filter((function(t){var e=t.tab;return!n.has(e.id)}));if(i.length>0){var u={};i.forEach((function(t){var e=t.tab,r=t.analysis;if(r.topics&&r.topics.length>0){var n=r.topics[0];u[n]||(u[n]=[]),u[n].push(e)}})),Object.entries(u).forEach((function(t){var e=c(t,2),o=e[0],a=e[1];if(a.length>=2){var i=o.charAt(0).toUpperCase()+o.slice(1);r[i]=a,a.forEach((function(t){return n.add(t.id)}))}}))}var s=t.filter((function(t){return!n.has(t.id)}));return s.length>0&&(r.Other=s),r};function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function M(){M=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(A([])));k&&k!==r&&n.call(k,i)&&(w=k);var E=b.prototype=g.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==C(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?m:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(C(e)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new S(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(E),s(E,u,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function D(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){D(a,n,o,i,c,"next",t)}function c(t){D(a,n,o,i,c,"throw",t)}i(void 0)}))}}var U="ai_tab_manager_saved_groups",z=function(){var t=F(M().mark((function t(e,r){var n,o;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Y();case 3:return n=t.sent,o={id:q(),name:e,tabs:r,createdAt:Date.now(),updatedAt:Date.now()},n.push(o),t.next=8,chrome.storage.local.set((a={},c=n,(i=function(t){var e=function(t){if("object"!=C(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==C(e)?e:e+""}(i=U))in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,a));case 8:return t.abrupt("return",{success:!0,group:o});case 11:return t.prev=11,t.t0=t.catch(0),console.error("Error saving tab group:",t.t0),t.abrupt("return",{success:!1,error:t.t0.message});case 15:case"end":return t.stop()}var a,i,c}),t,null,[[0,11]])})));return function(e,r){return t.apply(this,arguments)}}(),Y=function(){var t=F(M().mark((function t(){var e;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.storage.local.get(U,(function(e){t(e[U]||[])}))}));case 3:return e=t.sent,t.abrupt("return",e);case 7:return t.prev=7,t.t0=t.catch(0),console.error("Error loading tab groups:",t.t0),t.abrupt("return",[]);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}(),q=function(){return Date.now().toString(36)+Math.random().toString(36).substring(2)};function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function R(){R=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(A([])));k&&k!==r&&n.call(k,i)&&(w=k);var E=b.prototype=g.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==H(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?m:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(H(e)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new S(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(E),s(E,u,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function W(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var $="ai_tab_manager_tab_activity",B=function(){var t,e=(t=R().mark((function t(){var e;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.storage.local.get($,(function(e){t(e[$]||{})}))}));case 3:return e=t.sent,t.abrupt("return",e);case 7:return t.prev=7,t.t0=t.catch(0),console.error("Error loading tab activity data:",t.t0),t.abrupt("return",{});case 11:case"end":return t.stop()}}),t,null,[[0,7]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){W(a,n,o,i,c,"next",t)}function c(t){W(a,n,o,i,c,"throw",t)}i(void 0)}))});return function(){return e.apply(this,arguments)}}();function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function J(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,s=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Q(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function V(){V=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",m="completed",v={};function g(){}function y(){}function b(){}var w={};s(w,i,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(A([])));k&&k!==r&&n.call(k,i)&&(w=k);var E=b.prototype=g.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==K(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?m:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(K(e)+" is not iterable")}return y.prototype=b,o(E,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:y,configurable:!0}),y.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(S.prototype),s(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new S(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(E),s(E,u,"Generator"),s(E,i,(function(){return this})),s(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=A,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function X(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Z(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?X(Object(r),!0).forEach((function(e){tt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function tt(t,e,r){return(e=function(t){var e=function(t){if("object"!=K(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=K(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function et(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function rt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){et(a,n,o,i,c,"next",t)}function c(t){et(a,n,o,i,c,"throw",t)}i(void 0)}))}}var nt={tabGroups:{},tabMetadata:{},tabHistory:[],settings:{autoOrganize:!1,suggestCleanup:!0,cleanupThreshold:10,useAI:!0,syncEnabled:!1,syncInterval:60,tabLimit:10,closeStrategy:"oldest",notifyTabLimit:!0},lastTabLimitNotification:0},ot=function(){var t=rt(V().mark((function t(){var e;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.storage.sync.get(["settings","tabLimit","closeStrategy","notifyTabLimit"],(function(e){t(e)}))}));case 3:(e=t.sent).settings&&(nt.settings=Z(Z({},nt.settings),e.settings)),e.tabLimit&&(nt.settings.tabLimit=e.tabLimit),e.closeStrategy&&(nt.settings.closeStrategy=e.closeStrategy),void 0!==e.notifyTabLimit&&(nt.settings.notifyTabLimit=e.notifyTabLimit),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error loading settings:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}(),at=function(){var t=rt(V().mark((function t(e){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return nt.settings=Z(Z({},nt.settings),e),t.next=3,chrome.storage.sync.set({settings:nt.settings});case 3:return t.abrupt("return",nt.settings);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),it=function(){var t=rt(V().mark((function t(){var e;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.storage.local.get("tabMetadata",(function(e){t(e.tabMetadata)}))}));case 3:(e=t.sent)&&(nt.tabMetadata=e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error loading tab metadata:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}(),ct=function(){var t=rt(V().mark((function t(){var e,r,n,o,a,i,c,u,s,l,f,h,p,d,m,v=arguments;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=v.length>0&&void 0!==v[0]?v[0]:{},console.log("Starting tab organization..."),t.next=4,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 4:if((n=t.sent)&&!(n.length<2)){t.next=8;break}return console.log("Not enough tabs to organize"),t.abrupt("return",{success:!1,error:"Not enough tabs to organize"});case 8:if(!((o=r.ungroupedOnly?n.filter((function(t){return void 0===t.groupId||-1===t.groupId})):n).length<2)){t.next=12;break}return console.log("Not enough ungrouped tabs to organize"),t.abrupt("return",{success:!1,error:"Not enough ungrouped tabs to organize"});case 12:if("function"==typeof chrome.tabs.group&&"function"==typeof(null===(e=chrome.tabGroups)||void 0===e?void 0:e.update)){t.next=28;break}return console.warn("Tab Groups API not fully available, using fallback method"),t.prev=15,a=(new Date).toLocaleString(),i="Auto-Organized - ".concat(a),c=o.map((function(t){return{url:t.url,title:t.title,favIconUrl:t.favIconUrl||"",savedAt:Date.now()}})),t.next=21,z(i,c);case 21:return t.abrupt("return",{success:!0,fallback:!0,message:"Tab Groups API not available, but ".concat(o.length,' tabs were saved to "').concat(i,'" for reference.')});case 24:return t.prev=24,t.t0=t.catch(15),console.error("Error in fallback tab saving:",t.t0),t.abrupt("return",{success:!1,error:"Could not organize tabs. Your browser may not support tab groups. Check you are using Chrome version 89 or newer."});case 28:if(t.prev=28,!nt.settings.useAI){t.next=44;break}return t.next=32,O(o);case 32:u=t.sent,s=V().mark((function t(){var e,r,n,o,a;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=J(f[l],2),r=e[0],!((n=e[1]).length>1)){t.next=28;break}return t.prev=2,o=n.map((function(t){return t.id})),t.prev=4,t.next=7,new Promise((function(t,e){chrome.tabs.group({tabIds:o},(function(r){chrome.runtime.lastError?e(chrome.runtime.lastError):t(r)}))}));case 7:a=t.sent,t.next=14;break;case 10:return t.prev=10,t.t0=t.catch(4),console.error("Error creating tab group:",t.t0),t.abrupt("return",1);case 14:if(void 0===a){t.next=23;break}return t.prev=15,t.next=18,new Promise((function(t){chrome.tabGroups.update(a,{title:r},(function(){chrome.runtime.lastError&&console.warn("Failed to set group name:",chrome.runtime.lastError),t()}))}));case 18:t.next=23;break;case 20:t.prev=20,t.t1=t.catch(15),console.warn("Error setting group title:",t.t1);case 23:t.next=28;break;case 25:t.prev=25,t.t2=t.catch(2),console.error("Error creating tab group for",r,t.t2);case 28:case"end":return t.stop()}}),t,null,[[2,25],[4,10],[15,20]])})),l=0,f=Object.entries(u);case 35:if(!(l<f.length)){t.next=42;break}return t.delegateYield(s(),"t1",37);case 37:if(!t.t1){t.next=39;break}return t.abrupt("continue",39);case 39:l++,t.next=35;break;case 42:t.next=55;break;case 44:h={},o.forEach((function(t){try{var e=new URL(t.url).hostname;h[e]||(h[e]=[]),h[e].push(t.id)}catch(e){console.warn("Invalid URL:",t.url)}})),p=V().mark((function t(){var e,r,n,o,a;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=J(m[d],2),r=e[0],!((n=e[1]).length>1)){t.next=30;break}return t.prev=2,t.prev=3,t.next=6,new Promise((function(t,e){chrome.tabs.group({tabIds:n},(function(r){chrome.runtime.lastError?e(chrome.runtime.lastError):t(r)}))}));case 6:o=t.sent,t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(3),console.error("Error creating tab group:",t.t0),t.abrupt("return",1);case 13:if(void 0===o){t.next=25;break}return(a=r.replace("www.","")).includes(".")&&(a=a.split(".")[0]),a=a.charAt(0).toUpperCase()+a.slice(1),t.prev=17,t.next=20,new Promise((function(t){chrome.tabGroups.update(o,{title:a},(function(){chrome.runtime.lastError&&console.warn("Failed to set group name:",chrome.runtime.lastError),t()}))}));case 20:t.next=25;break;case 22:t.prev=22,t.t1=t.catch(17),console.warn("Error setting group title:",t.t1);case 25:t.next=30;break;case 27:t.prev=27,t.t2=t.catch(2),console.error("Error creating tab group for",r,t.t2);case 30:case"end":return t.stop()}}),t,null,[[2,27],[3,9],[17,22]])})),d=0,m=Object.entries(h);case 48:if(!(d<m.length)){t.next=55;break}return t.delegateYield(p(),"t2",50);case 50:if(!t.t2){t.next=52;break}return t.abrupt("continue",52);case 52:d++,t.next=48;break;case 55:return t.abrupt("return",{success:!0,message:"Organized ".concat(o.length," tabs into groups!")});case 58:return t.prev=58,t.t3=t.catch(28),console.error("Error organizing tabs:",t.t3),t.abrupt("return",{success:!1,error:t.t3.message||"Failed to organize tabs"});case 62:case"end":return t.stop()}}),t,null,[[15,24],[28,58]])})));return function(){return t.apply(this,arguments)}}(),ut=function(){var t=rt(V().mark((function t(e){var r,n,o,a;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 2:return r=t.sent,n=(new Date).toLocaleString(),o=e||"Saved Tabs - ".concat(n),a=r.map((function(t){return{url:t.url,title:t.title,favIconUrl:t.favIconUrl||"",savedAt:Date.now()}})),t.next=8,z(o,a);case 8:return t.abrupt("return",{success:!0,message:"Saved ".concat(r.length,' tabs to "').concat(o,'"')});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),st=function(){var t=rt(V().mark((function t(e){var r,n,o,a,i;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&0!==e.length){t.next=5;break}return t.next=3,new Promise((function(t){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){return t(e)}))}));case 3:r=t.sent,e=r.map((function(t){return t.id}));case 5:return t.next=7,Promise.all(e.map((function(t){return new Promise((function(e){chrome.tabs.get(t,(function(t){return e(t)}))}))})));case 7:return n=t.sent,o=(new Date).toLocaleString(),a="Archived - ".concat(o),i=n.map((function(t){return{url:t.url,title:t.title,favIconUrl:t.favIconUrl||"",archivedAt:Date.now()}})),t.next=13,z(a,i);case 13:return chrome.tabs.remove(e),t.abrupt("return",{success:!0,message:"Archived ".concat(e.length,' tabs to "').concat(a,'"')});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),lt=function(){var t=rt(V().mark((function t(){var e,r,n,o;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 2:return e=t.sent,t.next=5,B();case 5:return r=t.sent,n=Date.now(),(o=e.filter((function(t){var e=r[t.id];return!(!e||!e.lastAccessed)&&(n-e.lastAccessed)/864e5>7}))).length>0&&chrome.notifications.create("idle-tabs-notification",{type:"basic",iconUrl:"/icons/icon128.png",title:"Tab Cleanup Suggestion",message:"You have ".concat(o.length," tabs that haven't been used in over a week. Would you like to archive them?"),buttons:[{title:"Archive Now"},{title:"Dismiss"}]}),t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ft=function(){var t=rt(V().mark((function t(e){var r,n,o;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 2:return r=t.sent,n=e.toLowerCase().split(/\s+/),o=r.map((function(t){var e=t.title.toLowerCase(),r=t.url.toLowerCase(),o=0;return n.forEach((function(t){e.includes(t)&&(o+=2),r.includes(t)&&(o+=1)})),{tab:t,score:o}})),t.abrupt("return",o.filter((function(t){return t.score>0})).sort((function(t,e){return e.score-t.score})).map((function(t){return t.tab})));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ht=function(){var t=rt(V().mark((function t(e,r){var n;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&0!==e.length){t.next=2;break}return t.abrupt("return",{success:!1,error:"No tabs specified"});case 2:if(t.prev=2,chrome.tabGroups){t.next=6;break}return console.warn("Tab Groups API is not available in this browser"),t.abrupt("return",{success:!1,error:"Tab Groups API is not available in this browser. Try using Chrome version 89 or newer."});case 6:return t.next=8,new Promise((function(t,r){try{chrome.tabs.group({tabIds:e},(function(e){chrome.runtime.lastError?r(chrome.runtime.lastError):t(e)}))}catch(t){r(t)}}));case 8:if(void 0===(n=t.sent)){t.next=18;break}return t.prev=10,t.next=13,new Promise((function(t,e){chrome.tabGroups.update(n,{title:r||"New Group"},(function(){chrome.runtime.lastError?(console.warn("Failed to set group name:",chrome.runtime.lastError),t()):t()}))}));case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(10),console.warn("Error setting group name:",t.t0);case 18:return t.abrupt("return",{success:!0,groupId:n});case 21:return t.prev=21,t.t1=t.catch(2),console.error("Error creating tab group:",t.t1),t.abrupt("return",{success:!1,error:t.t1.message||"Failed to create tab group"});case 25:case"end":return t.stop()}}),t,null,[[2,21],[10,15]])})));return function(e,r){return t.apply(this,arguments)}}();chrome.runtime.onMessage.addListener((function(t,e,r){return rt(V().mark((function e(){var n,o,a,i,c,u,s,l;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={success:!1},e.t0=t.action,e.next="organizeTabs"===e.t0?4:"saveTabs"===e.t0?9:"archiveTabs"===e.t0?13:"updateSettings"===e.t0?17:"getSettings"===e.t0?21:"updateTabLimit"===e.t0?23:"updateCloseStrategy"===e.t0?28:"updateNotifyTabLimit"===e.t0?33:"naturalLanguageSearch"===e.t0?38:"createNewGroup"===e.t0?43:"createTabGroup"===e.t0?80:84;break;case 4:return e.next=6,ct({ungroupedOnly:t.ungroupedOnly});case 6:return(n=e.sent).fallback&&n.success&&(n.message=n.message||"Tabs organized successfully using alternative method. Your tabs were saved for reference."),e.abrupt("break",85);case 9:return e.next=11,ut(t.groupName);case 11:return n=e.sent,e.abrupt("break",85);case 13:return e.next=15,st(t.tabIds);case 15:return n=e.sent,e.abrupt("break",85);case 17:return e.next=19,at(t.settings);case 19:case 21:return n={success:!0,settings:nt.settings},e.abrupt("break",85);case 23:return nt.settings.tabLimit=t.tabLimit,e.next=26,chrome.storage.sync.set({tabLimit:t.tabLimit,settings:nt.settings});case 26:return n={success:!0,tabLimit:t.tabLimit},e.abrupt("break",85);case 28:return nt.settings.closeStrategy=t.closeStrategy,e.next=31,chrome.storage.sync.set({closeStrategy:t.closeStrategy,settings:nt.settings});case 31:return n={success:!0,closeStrategy:t.closeStrategy},e.abrupt("break",85);case 33:return nt.settings.notifyTabLimit=t.notifyTabLimit,e.next=36,chrome.storage.sync.set({notifyTabLimit:t.notifyTabLimit,settings:nt.settings});case 36:return n={success:!0,notifyTabLimit:t.notifyTabLimit},e.abrupt("break",85);case 38:return e.next=40,ft(t.query);case 40:return o=e.sent,n={success:!0,results:o},e.abrupt("break",85);case 43:return e.next=45,new Promise((function(t){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){return t(e)}))}));case 45:if(!((a=e.sent).length>0)){e.next=78;break}if(e.prev=47,"function"==typeof chrome.tabs.group&&"function"==typeof(null===(i=chrome.tabGroups)||void 0===i?void 0:i.update)){e.next=57;break}return c=(new Date).toLocaleString(),u="New Group - ".concat(c),s=a.map((function(t){return{url:t.url,title:t.title,favIconUrl:t.favIconUrl||"",savedAt:Date.now()}})),e.next=55,z(u,s);case 55:return n={success:!0,fallback:!0,message:'Tab Groups API not available, but the tab was saved to "'.concat(u,'" for reference.')},e.abrupt("break",85);case 57:return e.next=59,new Promise((function(t,e){try{chrome.tabs.group({tabIds:[a[0].id]},(function(r){chrome.runtime.lastError?e(chrome.runtime.lastError):t(r)}))}catch(t){e(t)}}));case 59:if(void 0===(l=e.sent)){e.next=69;break}return e.prev=61,e.next=64,new Promise((function(t){chrome.tabGroups.update(l,{title:"New Group"},(function(){chrome.runtime.lastError&&console.warn("Failed to set group name:",chrome.runtime.lastError),t()}))}));case 64:e.next=69;break;case 66:e.prev=66,e.t1=e.catch(61),console.warn("Error setting group name:",e.t1);case 69:n={success:!0,groupId:l},e.next=76;break;case 72:e.prev=72,e.t2=e.catch(47),console.error("Error creating new group:",e.t2),n={success:!1,error:e.t2.message||"Failed to create new group"};case 76:e.next=79;break;case 78:n={success:!1,error:"No active tab found"};case 79:return e.abrupt("break",85);case 80:return e.next=82,ht(t.tabIds,t.groupName);case 82:return n=e.sent,e.abrupt("break",85);case 84:n={success:!1,error:"Unknown action"};case 85:r(n);case 86:case"end":return e.stop()}}),e,null,[[47,72],[61,66]])})))(),!0})),chrome.tabs.onActivated.addListener((function(t){var e,r;e=t.tabId,r=t.windowId,nt.tabMetadata[e]||(nt.tabMetadata[e]={}),nt.tabMetadata[e].lastAccessed=Date.now(),nt.tabMetadata[e].windowId=r,chrome.storage.local.set({tabMetadata:nt.tabMetadata}),chrome.tabs.get(t.tabId,(function(t){t&&t.url&&(nt.tabHistory.unshift({url:t.url,title:t.title,timestamp:Date.now()}),nt.tabHistory.length>100&&(nt.tabHistory=nt.tabHistory.slice(0,100)),chrome.storage.local.set({tabHistory:nt.tabHistory}))}))})),setInterval(rt(V().mark((function t(){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!nt.settings.suggestCleanup){t.next=7;break}return t.next=3,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 3:if(!(t.sent.length>=nt.settings.cleanupThreshold)){t.next=7;break}return t.next=7,lt();case 7:case"end":return t.stop()}}),t)}))),36e5),chrome.notifications.onButtonClicked.addListener((function(t,e){"idle-tabs-notification"===t?0===e&&lt().then((function(t){var e=t.map((function(t){return t.id}));st(e)})):"tab-limit-notification"===t&&0===e&&dt()}));var pt=function(){var t=rt(V().mark((function t(){var e,r;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 3:if(!((e=t.sent).length<=nt.settings.tabLimit)){t.next=6;break}return t.abrupt("return");case 6:console.log("Tab limit exceeded: ".concat(e.length," tabs open, limit is ").concat(nt.settings.tabLimit)),nt.settings.notifyTabLimit&&(r=Date.now())-nt.lastTabLimitNotification>6e4&&(nt.lastTabLimitNotification=r,chrome.notifications.create("tab-limit-notification",{type:"basic",iconUrl:"icons/icon128.png",title:"Tab Limit Reached",message:"You have ".concat(e.length," tabs open, exceeding your limit of ").concat(nt.settings.tabLimit,"."),buttons:[{title:"Close Tabs"},{title:"Dismiss"}],priority:2})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error checking tab limit:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}(),dt=function(){var t=rt(V().mark((function t(){var e,r,n,o,a,i,c,u,s;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,new Promise((function(t){chrome.tabs.query({},(function(e){return t(e)}))}));case 3:if(e=t.sent,!((r=Math.max(0,e.length-nt.settings.tabLimit))<=0)){t.next=7;break}return t.abrupt("return");case 7:if(n=[],"oldest"!==nt.settings.closeStrategy){t.next=16;break}return t.next=11,B();case 11:o=t.sent,a=e.map((function(t){var e;return{tab:t,lastAccessed:(null===(e=o[t.id])||void 0===e?void 0:e.lastAccessed)||Date.now()}})).sort((function(t,e){return t.lastAccessed-e.lastAccessed})),n=a.slice(0,r).map((function(t){return t.tab.id})),t.next=22;break;case 16:if("leastUsed"!==nt.settings.closeStrategy){t.next=22;break}return t.next=19,B();case 19:i=t.sent,c=e.map((function(t){var e;return{tab:t,accessCount:(null===(e=i[t.id])||void 0===e?void 0:e.accessCount)||0}})).sort((function(t,e){return t.accessCount-e.accessCount})),n=c.slice(0,r).map((function(t){return t.tab.id}));case 22:if(!(n.length>0)){t.next=31;break}return t.next=25,new Promise((function(t){chrome.tabs.query({currentWindow:!0},(function(e){var r=e.filter((function(t){return n.includes(t.id)}));t(r)}))}));case 25:return u=t.sent,s=u.map((function(t){return{url:t.url,title:t.title,favIconUrl:t.favIconUrl||"",savedAt:Date.now()}})),t.next=29,z("Auto-closed tabs - ".concat((new Date).toLocaleString()),s);case 29:chrome.tabs.remove(n),chrome.notifications.create("tabs-closed-notification",{type:"basic",iconUrl:"icons/icon128.png",title:"Tabs Closed",message:"".concat(n.length," tabs were closed based on your settings. They have been saved for reference."),priority:1});case 31:t.next=36;break;case 33:t.prev=33,t.t0=t.catch(0),console.error("Error handling tab limit action:",t.t0);case 36:case"end":return t.stop()}}),t,null,[[0,33]])})));return function(){return t.apply(this,arguments)}}();chrome.tabs.onCreated.addListener((function(){pt()})),function(){var t=rt(V().mark((function t(){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ot();case 2:return t.next=4,it();case 4:chrome.tabs.query({},(function(t){var e=new Set(t.map((function(t){return t.id})));Object.keys(nt.tabMetadata).map(Number).forEach((function(t){e.has(t)||delete nt.tabMetadata[t]})),chrome.storage.local.set({tabMetadata:nt.tabMetadata})})),setInterval(pt,5e3);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()})();